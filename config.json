{
	"name": "API Sync",
	"namespace": "Vanderbilt\\APISyncExternalModule",
	"framework-version": 2,
	"description": "Automates exporting/importing to/from remote REDCap servers via the API.  The Data Dictionaries for the local and remote projects are expected to be either identical or compatible.  This module could easily be expanded to support additional scenarios.",
	"authors": [
		{
			"name": "Mark McEver",
			"email": "datacore@vumc.org",
			"institution": "Vanderbilt University Medical Center"
		}
	],
	"permissions": [
		"redcap_save_record",
		"redcap_every_page_before_render"
	],
	"project-settings": [
		{
			"key": "top-descriptive",
			"name": "See the <b>API Sync</b> page/link in the left menu for logs and one time sync options.",
			"type": "descriptive"
		},
		{
			"key": "disable-error-emails",
			"name": "<div style='max-width: 350px; display: inline-block; vertical-align: top;'>Disable error notification emails to superusers on the project (or the general system admin email if there are none on the project).</div>",
			"type": "checkbox"
		},
		{
			"key": "push-descriptive",
			"name": "<h5 style='margin-top: 10px'>Real-Time Push</h5> The real-time push feature overwrites remote data with local data within about a minute of a record being saved (or deleted).",
			"type": "descriptive"
		},
		{
			"key": "push-batch-size",
			"name": "Real-time push batch size (optional)",
			"type": "text"
		},
		{
			"key": "push-servers",
			"name": "Real-Time Push Destinations",
			"type": "sub_settings",
			"repeatable" : true,
			"sub_settings" : [
				{
					"key": "push-redcap-url",
					"name": "Remote REDCap URL",
					"type": "text"
				},
				{
					"key": "push-projects",
					"name": "Project",
					"type": "sub_settings",
					"repeatable" : true,
					"sub_settings" : [
						{
							"key": "push-project-name",
							"name": "<div style='max-width: 350px; display: inline-block; vertical-align: top;'><b>Project Name</b> - This is required, but is only used for local logging and does not have to exactly match the remote project.</div>",
							"type": "text"
						},
						{
							"key": "push-api-key",
							"name": "API Key",
							"type": "text"
						}
					]
				}
			]
		},
		{
			"key": "import-descriptive",
			"name": "<h5 style='margin-top: 10px'>Daily Import</h5> This feature overwrites local data with remote data daily.  This may take a long time on large projects.  In one test case an import took 15 minutes for a project with about 10,000 records and 1,500 fields.",
			"type": "descriptive"
		},
		{
			"key": "servers",
			"name": "Daily Import Sources",
			"type": "sub_settings",
			"repeatable" : true,
			"sub_settings" : [
				{
					"key": "redcap-url",
					"name": "Remote REDCap URL",
					"type": "text"
				},
				{
					"key": "daily-record-import-hour",
					"name": "Daily Record Import Hour (0-23)",
					"type": "text"
				},
				{
					"key": "daily-record-import-minute",
					"name": "Daily Record Import Minute (0-59)",
					"type": "text"
				},
				{
					"key": "projects",
					"name": "Project",
					"type": "sub_settings",
					"repeatable" : true,
					"sub_settings" : [
						{
							"key": "api-key",
							"name": "API Key",
							"type": "text"
						},
						{
							"key": "record-id-prefix",
							"name": "<div style='max-width: 350px; display: inline-block; vertical-align: top;'><b>Record ID Prefix</b> - If data is being imported from multiple projects or entered manually it is <b>highly recommended</b> to specify a record id prefix.  This prefix will be prepended to all imported records ids to ensure that they're unique.</div>",
							"type": "text"
						},
						{
							"key": "leave-unlocked",
							"name": "Skip form/instance locking after import",
							"type": "checkbox"
						}
					]
				}
			]
		}
	],
	"links": {
		"project": [
			{
				"name": "API Sync",
				"icon": "databases_arrow",
				"url": "api-sync.php",
				"show-header-and-footer": true
			}
		]
	},
	"crons": [
		{
			"cron_name": "cron",
			"cron_description": "API Sync External Module",
			"method": "cron",
			"cron_frequency": "1",
			"cron_max_run_time": "7200"
		}
	],
	"compatibility": {
		"redcap-version-min": "9.0.0",
		"redcap-version-min-reason": "EM Framework commit b184817 is required"
	}
}
